# 记忆科技采购建议项目
RAMAXEL-ProcureSense-algorithm
git地址：http://192.168.31.204/hg-algorithm/ramaxel-procuresense-algorithm.git
#### 1. 概述

该采购建议算法旨在满足净需求的基础上，最小化超买量，并趋近于满足物料的理论采购比例（PN 比例）及供应商的理论采购配额（MPN 比例）。算法有两个核心目标：

* **目标 1**: 最小化超买量。

* **目标 2**: 最小化与 PN、MPN 理论采购比例的偏差。

该算法通过线性规划模型求解，确保在满足需求的同时，兼顾物料和供应商的采购比例。

#### 2. 符号定义

| 符号          | 描述                                        |
| :---------- | :---------------------------------------- |
| **【需求属性】**  |                                           |
| $i$         | 需求编号，$i=1,2,\cdots,I$                     |
| $h'$        | 需求下的物料编码，$h'\in \{1,2,\cdots,H\}$         |
| $D_i$       | 第 $i$ 个需求，需求集合 $D=\{D_1,D_2,\cdots,D_I\}$ |
| $Q_i$       | 需求 $D_i$ 的净需求量                            |
| **【物料属性】**  |                                           |
| $h$         | 物料编码，$h=1,2,\cdots,H$                     |
| $r_{h}$     | 第 $h$ 个物料的 PN 理论采购比例                      |
| **【供应商属性】** |                                           |
| $k$         | 供应商编号，$k=1,2,\cdots,K$                    |
| $R_{hk}$    | 物料 $h$ 对应供应商 $k$ 的 MPN 理论采购比例             |
| $PQ_{hk}$   | 物料 $h$ 对应供应商 $k$ 的已购量                     |
| $Moq_{hk}$  | 物料 $h$ 对应供应商 $k$ 的最小起购量                   |
| $Mpq_{hk}$  | 物料 $h$ 对应供应商 $k$ 的最小包装量                   |

**决策变量**

* $X_{hk}$：供应商 $k$ 对物料 $h$ 的建议采购量。

* $x_{ih'}$：需求 $i$ 的物料 $h'$的分配量。

#### 3. 数学模型

##### 3.1 约束条件

* **需求分配约束**：同一个需求内各物料分配总量等于该需求的净需求量

$$
Q_i = \sum_{h'} x_{ih'}, \quad \forall i
$$

* **物料采购量约束**：对于每一个物料，物料的建议采购量必须满足其需求

$$
\sum_{i=1}^{I} x_{ih'} \leq \sum_{k=1}^{K} X_{hk}, \quad \forall h=h'
$$

* **供应商采购量约束**：每个供应商的物料建议采购量必须大于等于 MOQ（最小订购量）且是 MPQ（最小包装量）的倍数

$$
X_{hk} \geq Moq_{hk}, \quad \forall h, k
$$

$$
X_{hk} \in Mpq_{hk} \mathbb{Z}, \quad \forall h, k
$$

##### 3.2 目标函数

**目标 1：最小化超买量**

$$
f_1 = \min \left( \sum_{h=1}^{H} \sum_{k=1}^{K} X_{hk} - \sum_{i=1}^{I} Q_i \right)
$$

其中，$X_{hk}$ 是供应商 $k$ 对物料 $h$ 的采购建议量，$Q_i$ 是需求 $i$ 的净需求量。

**目标 2：最小化采购比例偏差**

$$
f_2 = \min \left( w_{pn} f_{pn} + w_{mpn} f_{mpn} \right)
$$

其中， $w_{pn}$ 和 $w_{mpn}$ 是 PN 比例偏差和 MPN 比例偏差的权重。

* **PN 比例的偏差**：定义为物料的实际采购量与其理论 PN 采购比例之间的偏差

$$
f_{pn} = \frac{1}{H} \sum_{h=1}^{H} \left| \sum_{k=1}^{K} \left( X_{hk} + PQ_{hk} \right) - r_h \sum_{h=1}^{H} \sum_{k=1}^{K} \left( X_{hk} + PQ_{hk} \right) \right|
$$

* **MPN 比例的偏差**：定义为供应商的实际采购量与其理论 MPN 采购比例之间的偏差

$$
f_{mpn} = \sum_{h=1}^{H} \frac{1}{\sum_{k=1}^{K} \lceil R_{hk} \rceil} \sum_{k=1}^{K} \left| \left( X_{hk} + PQ_{hk} \right) - R_{hk} \sum_{k=1}^{K} \left( X_{hk} + PQ_{hk} \right) \right|
$$

#### 4. 核心步骤

##### 4.1 优先级预处理

在计算之前，算法会根据 PN 比例和优先级对采购单元的需求数据进行筛选。对于每个需求：

* 如果物料有 PN 比例，则只保留有 PN 比例的物料

* 如果物料没有 PN 比例，则保留优先级最高的物料

##### 4.2 求解目标 1：最小化超买量

通过 `solverMinoOverPur()` 函数进行求解，目标是最小化采购量与净需求量的差值，即超买量。

##### 4.3 求解目标 2：最小化采购比例偏差

在最小化超买量的基础上，通过 `solveMinRatio()` 函数进一步最小化采购比例偏差。

##### 4.4 生成最终采购建议

通过 `generateResults()` 函数生成最终采购建议输出结构，包括：

* 每个物料对应各个供应商的建议采购量

* 超买量以及超买比例，其中超买比例指超买量占净需求量的比例

#### 5. 总结

该算法通过线性规划模型，结合物料和供应商的理论采购比例，解决了采购建议的优化问题。在保证满足净需求的基础上，尽量减少超买量，并使物料和供应商的建议采购量趋近于其理论比例。
